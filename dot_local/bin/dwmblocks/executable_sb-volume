#!/bin/sh

TERMINAL="alacritty"
TUI="wiremix"

case $BLOCK_BUTTON in
    1) "$TERMINAL" --class sysscratch -e "$TUI" ;;
    2) wpctl set-mute @DEFAULT_SINK@ toggle ;;
    3) wpctl set-mute @DEFAULT_SINK@ toggle ;;
    4) wpctl set-volume @DEFAULT_SINK@ 1%+ ;;
    5) wpctl set-volume @DEFAULT_SINK@ 1%- ;;
    6) setsid -f "$TERMINAL" -e "$EDITOR" "$0" ;;
esac

raw="$(wpctl get-volume @DEFAULT_AUDIO_SINK@)"

muted=false
echo "$raw" | grep -q '\[MUTED\]' && muted=true

vol="${raw#Volume: }"
vol="${vol% \[*}"

split() {
    IFS=$2
    set -- $1
    printf '%s' "$@"
}

vol="$(printf "%.0f" "$(split "$vol" ".")")"

echo -n "^c#afa193^vol:^d^ $vol%"

if [ "$muted" = true ]; then
    echo -n " (muted)"
fi

